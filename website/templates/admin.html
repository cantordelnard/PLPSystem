
{% extends "base.html" %}

<!-- =============== Title ================ -->
{% block title %}Admin | Dashboard{% endblock %}

<!-- =============== Sidebars ================ -->
{% block sidebar %}
<li class="active">
  <a href="admin">
    <span class="icon">
      <ion-icon name="grid-outline"></ion-icon>
    </span>
    <span class="title">DASHBOARD</span>
  </a>
</li>
<li>
  <a href="adminMaintenance">
    <span class="icon">
      <ion-icon name="cog-outline"></ion-icon>
    </span>
    <span class="title">MAINTENANCE</span>
  </a>
</li>
<li>
  <a href="adminUser">
    <span class="icon">
      <ion-icon name="person-outline"></ion-icon>
    </span>
    <span class="title">USERS</span>
  </a>
</li>
<li>
  <a href="adminPrediction">
      <span class="icon">
          <ion-icon name="sparkles-outline"></ion-icon>
      </span>
      <span class="title">PREDICTIVE</span>
  </a>
</li>
<li>
  <a href="adminUpload">
    <span class="icon">
      <ion-icon name="cloud-upload-outline"></ion-icon>
    </span>
    <span class="title">UPLOAD</span>
  </a>
</li>
<li>
  <a href="adminArchive">
    <span class="icon">
      <ion-icon name="archive-outline"></ion-icon>
    </span>
    <span class="title">ARCHIVE</span>
  </a>
</li>
{% endblock %}

<!-- =============== Flash Message ================ -->
{% block popupmessage %}
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
  {% for category, message in messages %}
  <div id="flash-message" class="info">
    <div class="info__icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="24" viewBox="0 0 24 24" height="24" fill="none">
        <path fill="#393a37"
          d="m12 1.5c-5.79844 0-10.5 4.70156-10.5 10.5 0 5.7984 4.70156 10.5 10.5 10.5 5.7984 0 10.5-4.7016 10.5-10.5 0-5.79844-4.7016-10.5-10.5-10.5zm.75 15.5625c0 .1031-.0844.1875-.1875.1875h-1.125c-.1031 0-.1875-.0844-.1875-.1875v-6.375c0-.1031.0844-.1875.1875-.1875h1.125c.1031 0 .1875.0844.1875.1875zm-.75-8.0625c-.2944-.00601-.5747-.12718-.7808-.3375-.206-.21032-.3215-.49305-.3215-.7875s.1155-.57718.3215-.7875c.2061-.21032.4864-.33149.7808-.3375.2944.00601.5747.12718.7808.3375.206.21032.3215.49305.3215.7875s-.1155.57718-.3215.7875c-.2061.21032-.4864.33149-.7808.3375z">
        </path>
      </svg>
    </div>
    <div class="info__title">{{ message }}</div>
    <div class="info__close">
      <svg height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg">
        <path
          d="m15.8333 5.34166-1.175-1.175-4.6583 4.65834-4.65833-4.65834-1.175 1.175 4.65833 4.65834-4.65833 4.6583 1.175 1.175 4.65833-4.6583 4.6583 4.6583 1.175-1.175-4.6583-4.6583z"
          fill="#393a37"></path>
      </svg>
    </div>
  </div>
  {% endfor %}
{% endif %}
{% endwith %}
{% endblock %}

<!-- =============== Main Content ================ -->
{% block main %}
<div class="content">
  <!-- ====== Welcome Note ====== -->
  <div class="partOne">
    {% if admin_info %}
    <h1>Welcome, Admin {{ admin_info['FirstName'] }} {{ admin_info['LastName'] }}!</h1>
    {% else %}
    <h1>ERROR FETCHING USERNAME</h1>
    {% endif %}
  </div>

  <!-- ====== Cards for Total Numbers ====== -->
  <div class="cardBox">
    <div class="card">
      <div>
        <div class="numbers">{{ '%02d' % student_count }}</div>
        <div class="cardName">STUDENTS</div>
      </div>
      <div class="iconBx">
        <ion-icon name="people-outline"></ion-icon>
      </div>
    </div>
    <div class="card">
      <div>
        <div class="numbers">{{ '%02d' % professor_count }}</div>
        <div class="cardName">PROFESSORS</div>
      </div>
      <div class="iconBx">
        <ion-icon name="briefcase-outline"></ion-icon>
      </div>
    </div>
    <div class="card">
      <div>
        <div class="numbers">{{ '%02d' % subject_count }}</div>
        <div class="cardName">SUBJECTS</div>
      </div>
      <div class="iconBx">
        <ion-icon name="library-outline"></ion-icon>
      </div>
    </div>
    <div class="card">
      <div>
        <div class="numbers">{{ '%02d' % admin_count }}</div>
        <div class="cardName">ADMINS</div>
      </div>
      <div class="iconBx">
        <ion-icon name="finger-print-outline"></ion-icon>
      </div>
    </div>
  </div>
<!-- ====== Bar Chart ====== -->
<div class="adminGraph">
  <canvas id="barChart"></canvas>
</div>

<!-- Add Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Add JavaScript code to fetch data and create chart -->
<script>
  // Fetch data from database using AJAX
fetch('/get_graduation_data')
  .then(response => response.json())
  .then(data => {
    // Create bar chart
    const ctx = document.getElementById('barChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.labels,
        datasets: [{
          label: 'Graduation Rates',
          data: data.values,
          backgroundColor: data.labels.map(label => {
            if (label === 'Will Graduate On Time') {
              return 'rgba(19, 123, 53, 0.8)'; // Green
            } else {
              return 'rgba(0, 0, 0, 0.8)'; // Black
            }
          }),
          borderColor: data.labels.map(label => {
            if (label === 'Will Graduate On Time') {
              return 'rgba(19, 123, 53, 1)'; // Green
            } else {
              return 'rgba(0, 0, 0, 1)'; // Black
            }
          }),
          borderWidth: 1
        }]
      },
      options: {
        title: {
          display: true,
          text: 'Graduation Rates'
        },
        scales: {
          y: {
            beginAtZero: true,
            max: 100
          }
        },
        plugins: {
          legend: {
            display: true,
            position: 'right',
            fontSize: 14,
            fontColor: 'black',
            labels: {
              generateLabels: function(chart) {
                return chart.data.labels.map(function(label, index) {
                  return {
                    text: label,
                    fillStyle: chart.data.datasets[0].backgroundColor[index],
                    strokeStyle: chart.data.datasets[0].borderColor[index]
                  };
                });
              }
            }
          }
        },
        animation: {
          animateScale: true,
          animateRotate: true
        }
      }
    });
  })
  .catch(error => console.error('Error:', error));
</script>

{% endblock %}
